[4.1 TCP 三次握手与四次挥手面试题 | 小林coding](https://xiaolincoding.com/network/3_tcp/tcp_interview.html#tcp-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E8%BF%87%E7%A8%8B%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84)
[TCP三次握手和四次挥手过程详细解析 - 掘金](https://juejin.cn/post/6844904080553279495#heading-8)
https://juejin.cn/post/6844904080553279495#heading-8

## 三次握手流程

![[Pasted image 20230208175202.png]]
![[Pasted image 20230208175228.png]]

### 第一次握手
客户端向服务端发送一个不带额外数据的特殊 TCP 报文段。这个报文段的 **SYN 标志位** 被设置为 1，而且会随机生成一个 32 序号，client_isn，放在 **序列号** 中。

### 第二次握手
服务端收到客户端发送的数据报，会根据收到的 client_isn，加 1，把结果放到 **确认应答号** 中，也会生成一个 server_isn，放到 **序列号**，然后把 **SYN标志位** 和 **ACK 标志位** 都设置为 1。发送给客户端。此次也不能携带数据。

### 第三次握手
客户端收到后，会根据收到的 server_isn，加 1，把结果放到 **确认应答号** 中，然后设置 **ACK 标志位** 为 1，发送给服务端。这次是可以携带数据的。

## 需要三次握手的首要原因

三次握手的**首要原因是为了防止旧的重复连接初始化造成混乱。**

**在两次握手的情况下，服务端没有中间状态给客户端来阻止历史连接，导致服务端可能建立一个历史连接，造成资源浪费**。

TCP 建立连接时，通过三次握手**能防止历史连接的建立，能减少双方不必要的资源开销，能帮助双方同步初始化序列号**。序列号能够保证数据包不重复、不丢弃和按序传输。

不使用「两次握手」和「四次握手」的原因：
- 「两次握手」：无法防止历史连接的建立，会造成双方资源的浪费，也无法可靠的同步双方序列号；
- 「四次握手」：三次握手就已经理论上最少可靠连接建立，所以不需要使用更多的通信次数。
